<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.junefw.infra.modules.member.MemberMpp">

	<resultMap id="resultMapObj"
		type="com.junefw.infra.modules.member.Member"></resultMap>

	<!-- **********************테스트******************** -->
<!-- http://localhost:8080/infra/member/memberListTest-->
	<select id="selectList" resultMap="resultMapObj">   
		select
		a.ifmmSeq
		,a.ifmmAdminNy
		,a.ifmmDormancyNy
		,a.ifmmName
		,a.ifmmNickname
		,a.ifmmPhoto
		,a.ifmmId
		,a.ifmmPassword
		,a.ifmmGrade
		,a.ifmmGenderCd
		,a.ifmmDob
		,a.ifmmSaveCd
		,a.ifmmFavoriteColor
		,a.ifmmEmailConsentNy
		,a.ifmmSmsConsentNy
		,a.ifmmPushConsentNy
		,a.ifmmDelNy
		from
		infrMember a
		where
		1=1
	</select>
	
	<insert id="insert">
		insert into infrMember(
		ifmmId
		,ifmmName
		,ifmmDelny
		)
		values (
		#{ifmmId}
		,#{ifmmName}
		,0
		)
	</insert>

<!-- http://localhost:8080/infra/member/memberFormTest  -->
	<select id="selectOne" resultMap="resultMapObj">
		select
		a.ifmmSeq
		, a.ifmmName
		, a.ifmmId
		, a.ifmmNickname
		, a.ifmmGrade
		, a.ifmmDob
		from
		infrMember a
		where
		1 = 1
		and ifmmDelNy = 0
		and ifmmSeq = #{ifmmSeq}
	</select>

	<update id="update">
		UPDATE infrMember SET
		ifmmName = #{ifmmName}
		where 1 =
		1
		and ifmmSeq = #{ifmmSeq}
	</update>

	<!-- **********************두리안********************* -->

	<sql id="selectCommon">
		FROM
		infrMember a
		WHERE 1 = 1
		<choose>
			<when test="shIfmmDelNy == 1">AND ifmmDelNy = 1 </when>   
			<when test="shIfmmDelNy == 0">AND ifmmDelNy = 0 </when>  
		</choose>
		<choose>
			<when test="shIfmmDormancyNy == 1">AND ifmmDormancyNy = 1 </when> 
			<when test="shIfmmDormancyNy == 0">AND ifmmDormancyNy = 0 </when>  
		</choose>
		<if test="shIfmmName != null and !shIfmmName.equals('')">
			AND ifmmName LIKE concat('%',#{shIfmmName},'%')</if>
		<choose>
			<when test="shMemberOption == 1">AND ifmmName LIKE concat('%',#{shMemberValue},'%')</when>
			<when test="shMemberOption == 2">AND ifmmId LIKE concat('%',#{shMemberValue},'%')</when>
			<when test="shMemberOption == 3">AND ifmmNickname LIKE concat('%',#{shMemberValue},'%')	</when>
			<when test="shMemberOption == 4">AND ifmpNumber LIKE concat('%',#{shMemberValue},'%')</when>
		</choose>
	</sql>

	<select id="selectOneCount" resultType="Integer">   <!-- selectCommon 사용 / 페이징 -->
		select
		count(*)
		<include refid="selectCommon"/>
	</select>

	<select id="memberList" resultMap="resultMapObj">
		select
		a.ifmmSeq
		,a.ifmmAdminNy
		,a.ifmmDormancyNy
		,a.ifmmName
		,a.ifmmNickname
		,a.ifmmPhoto
		,a.ifmmId
		,a.ifmmPassword
		,a.ifmmGrade
		,a.ifmmGenderCd
		,a.ifmmDob
		,a.ifmmSaveCd
		,a.ifmmFavoriteColor
		,a.ifmmEmailConsentNy
		,a.ifmmSmsConsentNy
		,a.ifmmPushConsentNy
		,a.ifmmDelNy
		,a.regDateTime
		,a.modDateTime
		,a.modSeq
		,b.ifmaTypeCd
		,b.ifmaTitle
		,b.ifmaAddress1
		,b.ifmaAddress2
		,b.ifmaZipCode
		,c.ifaoTypeCd
		,c.ifaoSnsTypeCd
		,c.ifaoTitle
		,c.ifaoUrl
		,d.ifmeTypeCd
		,d.ifmeEmailFull
		,e.ifjqQuestionCd
		,e.ifjqAnswer
		,f.ifnaSeq
		,g.ifnaName
		,h.ifmpTypeCd
		,h.ifmpDeviceCd
		,h.ifmpTelecomCd
		,h.ifmpNumber
		from
		infrMember a
		left join infrMemberAddress b on b.ifmmSeq = a.ifmmSeq and ifmaDefaultNy = 1
		left join infrMemberAddressOnline c on c.ifmmSeq= a.ifmmSeq and ifaoDefaultNy = 1
		left join infrMemberEmail d on d.ifmmSeq = a.ifmmSeq and ifmeDefaultNy = 1
		left join infrMemberJoinqna e on e.ifmmSeq = a.ifmmSeq
		left join infrMemberNationality f on f.ifmmSeq = a.ifmmSeq and ifmnDefaultNy = 1
		left join infrNationality g on g.ifnaSeq = f.ifnaSeq 
		left join infrMemberPhone h on h.ifmmSeq = a.ifmmSeq and ifmpDefaultNy = 1
		where
		1=1
		<choose>
			<when test="shIfmmDelNy == 1">AND ifmmDelNy = 1 </when>   
			<when test="shIfmmDelNy == 0">AND ifmmDelNy = 0 </when>  
		</choose>
		<choose>
			<when test="shIfmmDormancyNy == 1">AND ifmmDormancyNy = 1 </when> 
			<when test="shIfmmDormancyNy == 0">AND ifmmDormancyNy = 0 </when>  
		</choose>
		<if test="shIfmmName != null and !shIfmmName.equals('')">
			AND ifmmName LIKE concat('%',#{shIfmmName},'%')</if>
		<choose>
			<when test="shMemberOption == 1">AND ifmmName LIKE concat('%',#{shMemberValue},'%')</when>
			<when test="shMemberOption == 2">AND ifmmId LIKE concat('%',#{shMemberValue},'%')</when>
			<when test="shMemberOption == 3">AND ifmmNickname LIKE concat('%',#{shMemberValue},'%')	</when>
			<when test="shMemberOption == 4">AND ifmpNumber LIKE concat('%',#{shMemberValue},'%')</when>
		</choose>
				limit  #{startRnumForMysql} , #{rowNumToShow}
	</select>



	<select id="memberViewAdmin" resultMap="resultMapObj">   <!-- 멤버뷰 -->
		select
		a.ifmmSeq
		,a.ifmmAdminNy
		,a.ifmmDormancyNy
		,a.ifmmName
		,a.ifmmNickname
		,a.ifmmPhoto
		,a.ifmmId
		,a.ifmmPassword
		,a.ifmmGrade
		,a.ifmmGenderCd
		,a.ifmmDob
		,a.ifmmSaveCd
		,a.ifmmFavoriteColor
		,a.ifmmEmailConsentNy
		,a.ifmmSmsConsentNy
		,a.ifmmPushConsentNy
		,a.ifmmDelNy
		,a.regDateTime
		,a.modDateTime
		,a.modSeq
		,b.ifmaTypeCd
		,b.ifmaTitle
		,b.ifmaAddress1
		,b.ifmaAddress2
		,b.ifmaZipCode
 		,c.ifaoTypeCd
		,c.ifaoSnsTypeCd
		,c.ifaoTitle
		,c.ifaoUrl
		,d.ifmeTypeCd
		,d.ifmeEmailFull
		,e.ifjqQuestionCd
		,e.ifjqAnswer
		,f.ifnaSeq
		,g.ifnaName
		,h.ifmpTypeCd
		,h.ifmpDeviceCd
		,h.ifmpTelecomCd
		,h.ifmpNumber 
		from
	infrMember a
		left join infrMemberAddress b on b.ifmmSeq = a.ifmmSeq and ifmaDefaultNy = 1
		left join infrMemberAddressOnline c on c.ifmmSeq= a.ifmmSeq and ifaoDefaultNy = 1
		left join infrMemberEmail d on d.ifmmSeq = a.ifmmSeq and ifmeDefaultNy = 1
		left join infrMemberJoinqna e on e.ifmmSeq = a.ifmmSeq
		left join infrMemberNationality f on f.ifmmSeq = a.ifmmSeq and ifmnDefaultNy = 1
		left join infrNationality g on g.ifnaSeq = f.ifnaSeq 
		left join infrMemberPhone h on h.ifmmSeq = a.ifmmSeq and ifmpDefaultNy = 1
		where
		1=1
		and a.ifmmSeq = #{ifmmSeq}
	</select>

<insert id="insertMemberAdmin">
		insert into infrMember(
		ifmmName
		,ifmmId
		,ifmmNickname
		,ifmmPassword
		,ifmmGenderCd
		,ifmmDelny
		,ifmmSaveCd
		,ifmmEmailConsentNy
		,ifmmSmsConsentNy
		,ifmmPushConsentNy
		,regIp
		,regSeq
		,regDevice
		,regDateTime
		,regDateTimeSvr
		)
		values (
		#{ifmmName}
		,#{ifmmId}
		,#{ifmmNickname}
		,#{ifmmPassword}
		,#{ifmmGenderCd}
		,0
		,6
		,0
		,0
		,0
		,#{regIp}
		,#{regSeq}
		,#{regDevice}
		,now()
		,now()
		)
	</insert>


	<insert id="insertMemberUser">
		insert into infrMember(
		,ifmmName
		,ifmmId
		,ifmmPassword
		,ifmmGenderCd
		,ifmmDelny
		,ifmmSaveCd
		,ifmmMarriageCd
		,ifmmMarriageDate
		,ifmmChildrenNum
		,ifmmFavoriteColor
		,ifmmRecommenderSeq
		,ifmmEmailConsentNy
		,ifmmSmsConsentNy
		,ifmmPushConsentNy
		,ifmmDesc
		,ifmmDelNY
		,regIp
		,regSeq
		,regDevice
		,regDateTime
		,regDateTimeSvr
		)
		values (
		,#{ifmmName}
		,#{ifmmId}
		,#{ifmmPassword}
		,#{ifmmGenderCd}
		,0
		,#{ifmmSaveCd}
		,#{ifmmMarriageCd}
		,#{vfmmMarriageDate}
		,#{ifmmChildrenNum}
		,#{ifmmFavoriteColor}
		,#{ifmmRecommenderSeq}
		,#{ifmmEmailConsentNy}
		,#{ifmmSmsConsentNy}
		,#{ifmmPushConsentNy}
		,#{ifmmRecommenderSeq}
		,#{ifmmDesc}
		,#{ifmmDelNY}
		,#{regIp}
		,#{regSeq}
		,#{regDevice}
		,now()
		,now()
		)
	</insert>


</mapper>

